{"ast":null,"code":"import _slicedToArray from\"/Users/sylviayu/Desktop/project/create-vinyl-record/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useEffect,useState}from'react';var getPixelRatio=function getPixelRatio(context){var backingStore=context.backingStorePixelRatio||context.webkitBackingStorePixelRatio||context.mozBackingStorePixelRatio||context.msBackingStorePixelRatio||context.oBackingStorePixelRatio||context.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/backingStore;};var ChordsAnimation=function ChordsAnimation(props){//only if need to playchord then setchord\nvar curr_chord=props.curr_chord,playChord=props.playChord,setPlayChord=props.setPlayChord;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),audio=_useState2[0],setAudio=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),chord=_useState4[0],setChord=_useState4[1];// const [playChord, setPlayChord] =useState(false)\nvar canvasRef=useRef(null);var draw=function draw(ctx,frameCount){ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);ctx.fillStyle='white';var r=330;var c={x:350,y:350};if(chord){Object.keys(chord).forEach(function(item){ctx.beginPath();var i=chord[item];var deg=15+i*30;ctx.arc(c.x+r*Math.cos(deg*Math.PI/180),c.y+r*Math.sin(deg*Math.PI/180),8*Math.pow(Math.sin(frameCount*0.05),2),0,2*Math.PI);ctx.fill();});}};var play_sound=function play_sound(){if(audio){setChord(curr_chord);Object.keys(curr_chord).forEach(function(item){return audio.play(item+\"4\");});}};useEffect(function(){var Soundfont=require('soundfont-player');var audioContext=new AudioContext();Soundfont.instrument(audioContext,'marimba').then(function(soundFontPlayer){setAudio(soundFontPlayer);});//document.addEventListener('mousemove', onmousemove, false);\n},[]);useEffect(function(){if(audio&&playChord){play_sound();setPlayChord(false);}},[audio,playChord]);useEffect(function(){var canvas=canvasRef.current;var context=canvas.getContext('2d');var frameCount=0;var animationFrameId;var ratio=getPixelRatio(context);var width=window.getComputedStyle(canvas).getPropertyValue('width').slice(0,-2);var height=getComputedStyle(canvas).getPropertyValue('height').slice(0,-2);canvas.width=width*ratio;canvas.height=height*ratio;canvas.style.width=\"\".concat(width,\"px\");canvas.style.height=\"\".concat(height,\"px\");//Our draw came here\nvar render=function render(){frameCount++;draw(context,frameCount);animationFrameId=window.requestAnimationFrame(render);};render();return function(){window.cancelAnimationFrame(animationFrameId);};},[draw]);return/*#__PURE__*/React.createElement(\"canvas\",{ref:canvasRef,style:{width:window.innerWidth,height:window.innerHeigh}});};export default ChordsAnimation;","map":{"version":3,"sources":["/Users/sylviayu/Desktop/project/create-vinyl-record/src/Draw/ChordsAnmation.js"],"names":["React","useRef","useEffect","useState","getPixelRatio","context","backingStore","backingStorePixelRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","window","devicePixelRatio","ChordsAnimation","props","curr_chord","playChord","setPlayChord","audio","setAudio","chord","setChord","canvasRef","draw","ctx","frameCount","clearRect","canvas","width","height","fillStyle","r","c","x","y","Object","keys","forEach","item","beginPath","i","deg","arc","Math","cos","PI","sin","fill","play_sound","play","Soundfont","require","audioContext","AudioContext","instrument","then","soundFontPlayer","current","getContext","animationFrameId","ratio","getComputedStyle","getPropertyValue","slice","style","render","requestAnimationFrame","cancelAnimationFrame","innerWidth","innerHeigh"],"mappings":"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","sourcesContent":["import React, { useRef, useEffect, useState } from 'react'\n\nconst getPixelRatio = context => {\n  var backingStore =\n  context.backingStorePixelRatio ||\n  context.webkitBackingStorePixelRatio ||\n  context.mozBackingStorePixelRatio ||\n  context.msBackingStorePixelRatio ||\n  context.oBackingStorePixelRatio ||\n  context.backingStorePixelRatio ||\n  1;\n  \n  return (window.devicePixelRatio || 1) / backingStore;\n};\n\nconst ChordsAnimation = props => {\n  //only if need to playchord then setchord\n  const { curr_chord,  playChord, setPlayChord} = props\n  const [audio, setAudio] = useState(null)\n  const [chord, setChord] = useState()  \n  // const [playChord, setPlayChord] =useState(false)\n\n  const canvasRef = useRef(null)\n  \n  const draw = (ctx, frameCount) => {\n    \n    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height)\n    ctx.fillStyle = 'white'\n\n    const r = 330\n    const c = {x: 350, y: 350}\n\n    if (chord){\n      Object.keys(chord).forEach(item=> {\n        ctx.beginPath()\n        let i = chord[item]\n        let deg = 15 + i* 30\n        ctx.arc(c.x + r* Math.cos(deg * Math.PI /180), c.y + r* Math.sin(deg *Math.PI /180), 8*Math.sin(frameCount*0.05)**2, 0, 2*Math.PI)\n        ctx.fill()\n  \n      })\n    }\n\n  }\n\n  const play_sound = (() => {\n    if (audio){\n      setChord(curr_chord)\n\n      Object.keys(curr_chord).forEach(item => audio.play(item +\"4\"))\n      \n    }\n  })\n\n \n\n  useEffect(()=>{\n    var Soundfont = require('soundfont-player')\n    var  audioContext = new AudioContext()\n    Soundfont.instrument(audioContext, 'marimba')\n      .then(soundFontPlayer => {\n        setAudio(soundFontPlayer)\n      })\n    //document.addEventListener('mousemove', onmousemove, false);\n  }, [])\n\n  useEffect(()=>{\n\n    if (audio && playChord) {\n        \n        play_sound()\n        setPlayChord(false) \n            \n    }\n  }, [audio, playChord]);\n  \n  useEffect(() => {\n    const canvas = canvasRef.current\n    const context = canvas.getContext('2d')\n    let frameCount = 0\n    let animationFrameId\n    let ratio = getPixelRatio(context);\n    let width = window.getComputedStyle(canvas)\n        .getPropertyValue('width')\n        .slice(0, -2);\n    let height = getComputedStyle(canvas)\n        .getPropertyValue('height')\n       .slice(0, -2);\n  \n    canvas.width = width * ratio;\n    canvas.height = height * ratio;\n    canvas.style.width = `${width}px`;\n    canvas.style.height = `${height}px`;\n    \n    \n    //Our draw came here\n    const render = () => {\n      frameCount++\n      draw(context, frameCount)\n      animationFrameId = window.requestAnimationFrame(render)\n    }\n    render()\n    \n    return () => {\n      window.cancelAnimationFrame(animationFrameId)\n    }\n  }, [draw])\n  \n  return <canvas ref={canvasRef} style={{ width: window.innerWidth, height: window.innerHeigh}}/>\n}\n\nexport default ChordsAnimation"]},"metadata":{},"sourceType":"module"}